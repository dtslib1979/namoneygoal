<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>내 디지털 유튜브 | 남원골</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #A855F7;
      --accent: #F59E0B;
      --bg: #0a0a14;
      --card-bg: #1a1a2e;
      --text: #f5f5f5;
      --text-dim: #a0a0a0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    .header {
      background: var(--card-bg);
      padding: 30px 20px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .channel-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    .channel-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: bold;
    }

    .channel-details {
      text-align: left;
    }

    .channel-name {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .channel-stats {
      font-size: 14px;
      color: var(--text-dim);
    }

    .channel-stats span {
      margin-right: 15px;
    }

    .subscribe-btn {
      background: var(--accent);
      color: var(--bg);
      border: none;
      padding: 12px 24px;
      border-radius: 24px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .subscribe-btn:hover {
      transform: scale(1.05);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    .section-title {
      font-size: 18px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title::after {
      content: '';
      flex: 1;
      height: 1px;
      background: rgba(255,255,255,0.1);
    }

    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .video-card {
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .video-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    .video-thumbnail {
      position: relative;
      padding-top: 56.25%; /* 16:9 */
      background: #000;
    }

    .video-thumbnail img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .video-thumbnail .duration {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
    }

    .video-thumbnail .play-icon {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      background: rgba(0,0,0,0.3);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .video-card:hover .play-icon {
      opacity: 1;
    }

    .video-info {
      padding: 15px;
    }

    .video-title {
      font-size: 15px;
      font-weight: 600;
      line-height: 1.4;
      margin-bottom: 8px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .video-meta {
      font-size: 13px;
      color: var(--text-dim);
    }

    .video-meta span {
      margin-right: 10px;
    }

    /* Featured Video */
    .featured {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 40px;
    }

    @media (max-width: 768px) {
      .featured {
        grid-template-columns: 1fr;
      }
    }

    .featured-main {
      background: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
    }

    .featured-player {
      position: relative;
      padding-top: 56.25%;
      background: #000;
    }

    .featured-player iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    .featured-info {
      padding: 20px;
    }

    .featured-title {
      font-size: 20px;
      margin-bottom: 10px;
    }

    .featured-desc {
      font-size: 14px;
      color: var(--text-dim);
      line-height: 1.6;
    }

    .playlist {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 15px;
      max-height: 500px;
      overflow-y: auto;
    }

    .playlist-title {
      font-size: 14px;
      color: var(--text-dim);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .playlist-item {
      display: flex;
      gap: 12px;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .playlist-item:hover {
      background: rgba(255,255,255,0.05);
    }

    .playlist-item.active {
      background: rgba(168, 85, 247, 0.2);
    }

    .playlist-thumb {
      width: 100px;
      height: 56px;
      border-radius: 6px;
      background: #000;
      flex-shrink: 0;
      object-fit: cover;
    }

    .playlist-info {
      flex: 1;
      min-width: 0;
    }

    .playlist-info h4 {
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 4px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .playlist-info p {
      font-size: 12px;
      color: var(--text-dim);
    }

    /* Upload Modal */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      z-index: 100;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--card-bg);
      border-radius: 16px;
      width: 100%;
      max-width: 500px;
      padding: 30px;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 24px;
      cursor: pointer;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--text-dim);
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: var(--text);
      font-size: 14px;
    }

    .submit-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }

    .upload-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border: none;
      color: white;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(168, 85, 247, 0.4);
    }

    .powered-by {
      text-align: center;
      padding: 30px;
      font-size: 12px;
      color: var(--text-dim);
    }

    .powered-by a {
      color: var(--primary);
      text-decoration: none;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="channel-info">
      <div class="channel-avatar" id="channelAvatar">박</div>
      <div class="channel-details">
        <h1 class="channel-name" id="channelName">박씨TV</h1>
        <div class="channel-stats">
          <span id="videoCount">영상 0개</span>
          <span id="viewCount">조회수 0회</span>
        </div>
      </div>
      <button class="subscribe-btn">구독하기</button>
    </div>
  </header>

  <main class="container">
    <section class="featured" id="featuredSection" style="display: none;">
      <div class="featured-main">
        <div class="featured-player" id="featuredPlayer">
          <!-- YouTube embed will go here -->
        </div>
        <div class="featured-info">
          <h2 class="featured-title" id="featuredTitle">-</h2>
          <p class="featured-desc" id="featuredDesc">-</p>
        </div>
      </div>
      <div class="playlist">
        <div class="playlist-title">재생목록</div>
        <div id="playlistItems"></div>
      </div>
    </section>

    <section>
      <h2 class="section-title">모든 영상</h2>
      <div class="video-grid" id="videoGrid">
        <!-- Videos will be loaded here -->
      </div>
    </section>
  </main>

  <button class="upload-btn" id="uploadBtn">+</button>

  <!-- Upload Modal -->
  <div class="modal" id="uploadModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>영상 추가</h3>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      <form id="videoForm">
        <div class="form-group">
          <label>YouTube 영상 ID 또는 URL</label>
          <input type="text" name="videoId" placeholder="예: dQw4w9WgXcQ 또는 전체 URL" required>
        </div>
        <div class="form-group">
          <label>제목</label>
          <input type="text" name="title" placeholder="영상 제목" required>
        </div>
        <div class="form-group">
          <label>설명</label>
          <textarea name="description" rows="3" placeholder="영상 설명"></textarea>
        </div>
        <button type="submit" class="submit-btn">추가하기</button>
      </form>
    </div>
  </div>

  <footer class="powered-by">
    Powered by <a href="https://namoneygoal.kr">남원골</a> | AI 쓰는 중개인
  </footer>

  <script>
    // Video Gallery System
    class DigitalVideo {
      constructor() {
        this.config = null;
        this.videos = [];
        this.currentVideo = null;
        this.storageKey = 'nmg_videos';
        this.init();
      }

      async init() {
        await this.loadConfig();
        this.loadVideos();
        this.render();
        this.bindEvents();
      }

      async loadConfig() {
        const slotPath = window.location.pathname;
        const slotMatch = slotPath.match(/slots\/(slot\d+)/);

        if (slotMatch) {
          try {
            const response = await fetch(`/slots/${slotMatch[1]}/config.json`);
            this.config = await response.json();
            this.storageKey = `nmg_videos_${slotMatch[1]}`;
          } catch (e) {
            console.log('Using default config');
          }
        }

        if (!this.config) {
          this.config = {
            name: '박씨 중개사',
            channelName: '박씨TV'
          };
        }
      }

      loadVideos() {
        const stored = localStorage.getItem(this.storageKey);
        this.videos = stored ? JSON.parse(stored) : this.getSampleVideos();
      }

      saveVideos() {
        localStorage.setItem(this.storageKey, JSON.stringify(this.videos));
      }

      getSampleVideos() {
        return [
          {
            id: 'sample1',
            videoId: 'dQw4w9WgXcQ',
            title: '남원동 신축 아파트 투어',
            description: '오늘은 남원동에 새로 지어진 아파트를 둘러봅니다.',
            duration: '5:23',
            views: 1250,
            date: new Date().toISOString()
          },
          {
            id: 'sample2',
            videoId: 'dQw4w9WgXcQ',
            title: '2026년 시흥 부동산 전망',
            description: 'AI로 분석한 시흥 부동산 시장 전망입니다.',
            duration: '8:15',
            views: 3420,
            date: new Date(Date.now() - 86400000 * 3).toISOString()
          }
        ];
      }

      render() {
        // Update header
        const initial = (this.config.name || '?')[0];
        document.getElementById('channelAvatar').textContent = initial;
        document.getElementById('channelName').textContent = this.config.channelName || `${this.config.name}TV`;
        document.getElementById('videoCount').textContent = `영상 ${this.videos.length}개`;

        const totalViews = this.videos.reduce((sum, v) => sum + (v.views || 0), 0);
        document.getElementById('viewCount').textContent = `조회수 ${totalViews.toLocaleString()}회`;

        // Render videos
        this.renderVideoGrid();

        // Show featured if videos exist
        if (this.videos.length > 0) {
          this.showFeatured(this.videos[0]);
        }
      }

      renderVideoGrid() {
        const grid = document.getElementById('videoGrid');

        if (this.videos.length === 0) {
          grid.innerHTML = '<p style="color: var(--text-dim); text-align: center; grid-column: 1/-1; padding: 40px;">아직 영상이 없습니다</p>';
          return;
        }

        grid.innerHTML = this.videos.map(video => `
          <div class="video-card" data-id="${video.id}">
            <div class="video-thumbnail">
              <img src="https://img.youtube.com/vi/${video.videoId}/mqdefault.jpg" alt="${video.title}">
              <span class="duration">${video.duration || '0:00'}</span>
              <div class="play-icon">▶</div>
            </div>
            <div class="video-info">
              <h3 class="video-title">${video.title}</h3>
              <div class="video-meta">
                <span>조회수 ${(video.views || 0).toLocaleString()}회</span>
                <span>${this.formatDate(video.date)}</span>
              </div>
            </div>
          </div>
        `).join('');
      }

      showFeatured(video) {
        const section = document.getElementById('featuredSection');
        section.style.display = 'grid';

        document.getElementById('featuredPlayer').innerHTML = `
          <iframe src="https://www.youtube.com/embed/${video.videoId}"
                  allowfullscreen></iframe>
        `;
        document.getElementById('featuredTitle').textContent = video.title;
        document.getElementById('featuredDesc').textContent = video.description || '';

        this.currentVideo = video;
        this.renderPlaylist();
      }

      renderPlaylist() {
        const container = document.getElementById('playlistItems');
        container.innerHTML = this.videos.map(video => `
          <div class="playlist-item ${video.id === this.currentVideo?.id ? 'active' : ''}" data-id="${video.id}">
            <img class="playlist-thumb" src="https://img.youtube.com/vi/${video.videoId}/default.jpg" alt="">
            <div class="playlist-info">
              <h4>${video.title}</h4>
              <p>${video.duration || '0:00'}</p>
            </div>
          </div>
        `).join('');
      }

      formatDate(dateStr) {
        const date = new Date(dateStr);
        const now = new Date();
        const diff = now - date;
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));

        if (days === 0) return '오늘';
        if (days === 1) return '어제';
        if (days < 7) return `${days}일 전`;
        if (days < 30) return `${Math.floor(days / 7)}주 전`;
        return `${Math.floor(days / 30)}개월 전`;
      }

      extractVideoId(input) {
        // Handle full URLs or just video IDs
        const urlMatch = input.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\s]+)/);
        return urlMatch ? urlMatch[1] : input.trim();
      }

      bindEvents() {
        // Video card click
        document.getElementById('videoGrid').addEventListener('click', (e) => {
          const card = e.target.closest('.video-card');
          if (card) {
            const video = this.videos.find(v => v.id === card.dataset.id);
            if (video) this.showFeatured(video);
          }
        });

        // Playlist item click
        document.getElementById('playlistItems').addEventListener('click', (e) => {
          const item = e.target.closest('.playlist-item');
          if (item) {
            const video = this.videos.find(v => v.id === item.dataset.id);
            if (video) this.showFeatured(video);
          }
        });

        // Upload button
        document.getElementById('uploadBtn').addEventListener('click', () => {
          document.getElementById('uploadModal').classList.add('active');
        });

        // Close modal
        document.getElementById('closeModal').addEventListener('click', () => {
          document.getElementById('uploadModal').classList.remove('active');
        });

        // Submit form
        document.getElementById('videoForm').addEventListener('submit', (e) => {
          e.preventDefault();
          const formData = new FormData(e.target);

          const video = {
            id: Date.now().toString(),
            videoId: this.extractVideoId(formData.get('videoId')),
            title: formData.get('title'),
            description: formData.get('description'),
            duration: '0:00',
            views: 0,
            date: new Date().toISOString()
          };

          this.videos.unshift(video);
          this.saveVideos();
          this.render();

          e.target.reset();
          document.getElementById('uploadModal').classList.remove('active');
        });
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      new DigitalVideo();
    });
  </script>
</body>
</html>
